# Site authorization example

This package contains the example site authorization service based on Apache Kafka, that demonstrates how to use the 
code, generated by `go-asyncapi`.

## Prerequisites

[Go](https://go.dev/doc/install) and [Docker](https://docs.docker.com/get-docker/) installed.

## What's inside

* `asyncapi.yml` - the AsyncAPI document that describes our example authorization architecture
  * `docker-compose.yml` - infra definition generated by `go-asyncapi infra asyncapi.yml` command
  * `asyncapi/` - code generated by `go-asyncapi code asyncapi.yml` command
* `client.go` and `server.go` -- example client and server implementations

## Running the example

1. Start the Kafka broker using Docker:
   ```shell
   docker-compose up -d
   ```
2. Create a Kafka topic:
   ```shell
   docker compose exec test-server /opt/bitnami/kafka/bin/kafka-topics.sh --bootstrap-server test-server:9092 --create --topic authChannel-development --partitions 4
   ```
3. Run the auth server:
   ```shell
    go run server.go
    ```

Now, run the auth client to make a request `go run client.go`, the server will respond with the authorization result.

You may also run the auth server in "glitch" mode to inject random messages before the response, which a client should automatically ignore:
```shell
go run server.go -mode glitch
```

## Cleanup

To stop the Kafka broker, run:
```shell
docker-compose down
```
