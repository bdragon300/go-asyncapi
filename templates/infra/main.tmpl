# This file is generated by go-asyncapi tool

{{- $sections := list "services" "networks" "volumes" "configs" "secrets" }}
{{- range $section := $sections}}
{{$drawSection := true}}

{{- range $server := $.Objects}}
  {{- if ne $server.Kind "server"}}{{continue}}{{end}}

  {{- if $.ServerVariableGroups $server.Name}}
    {{- range $.ServerVariableGroups $server.Name}}
      {{- $ctx := dict "Server" $server "ServerVariables" .}}
      {{- with tryTmpl (print "infra/docker/" $server.Protocol "/" $section) $ctx}}
        {{- with $drawSection}}
{{$section}}:{{$drawSection = false}}
        {{- end}}
{{.}}
      {{- end}}
    {{- end}}
  {{- else if eq $server.Variables.Len 0 }}
    {{- $ctx := dict "Server" $server "ServerVariables" nil}}
    {{- with tryTmpl (print "infra/docker/" $server.Protocol "/" $section) $ctx}}
      {{- with $drawSection}}
{{$section}}:{{$drawSection = false}}
      {{- end}}
{{.}}
    {{- end}}
  {{- else}}
# NOTE: Server {{$server.Name}} contains server variables, please set them in go-asyncapi config infra.serverOpts (https://bdragon300.github.io/go-asyncapi/infrastructure-files-generation/)
    {{- continue}}
  {{- end}}

  {{- with tryTmpl (print "infra/docker/" $server.Protocol "/" $section "/extra") $server}}
{{.}}
  {{- end}}
{{- end}}

{{- range $.ActiveProtocols}}
{{- with tryTmpl (print "infra/docker/" . "/extra") $}}
{{.}}
{{- end}}
{{- end}}

{{- end}}