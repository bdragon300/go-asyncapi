{{- if .BindingsType}}
    {{- .BindingsType| godef }}
    {{- range $proto := .BindingsProtocols}}
        {{- $bindingsValue := $.ProtoBindingsValue $proto}}
        func (c *{{ $.BindingsType| gousage }}) {{ $proto | capitalize }}() {{$bindingsValue.Type| gousage}} {
        b := {{$bindingsValue| gousage}}
        {{- if $.BindingsPromise}}
            {{- $jvals := $.BindingsPromise.T.JSONValues.GetOrEmpty $proto}}
            {{- range $jval := $jvals.Entries}}
                {{- $jval.Key | toCamelCase }} := {{$jval.Value | golit}}
                _ = {{qual "encoding/json.Unmarshal"}}([]byte({{$jval.Key | toCamelCase }}), &b.{{$jval.Key}})
            {{- end}}
        {{- end}}
        return b
        }
    {{- end}}
{{- end }}

{{- $headersType := .HeadersFallbackType}}
{{- if .HeadersTypePromise}}
    {{- $headersType := .HeadersTypePromise.T}}
{{- end}}

{{- localobj .OutType}}
func New{{ .OutType | goid }}() *{{ .OutType| gousage }} {
    return &{{ .OutType| gousage }}{}
}

{{.OutType| godef}}

func (m *{{ .OutType | goid }}) WithPayload(payload {{.PayloadType| gousage}}) *{{ .OutType | goid }} {
    m.Payload = payload
    return m
}

func (m *{{ .OutType | goid }}) WithHeaders(headers {{$headersType| gousage}}) *{{ .OutType | goid }} {
    m.Headers = headers
    return m
}

{{- if .CorrelationIDPromise}}
func (m {{ .OutType | goid }}) SetCorrelationID(value {{ .CorrelationIDPromise.T.TargetVarType .OutType | gousage}}) {
    {{ .CorrelationIDPromise.T.RenderSetterBody "value" .OutType | gousage}}
}
{{- end}}

{{- localobj .InType}}
func New{{ .InType | goid }}() *{{ .InType| gousage }} {
    return &{{ .InType| gousage }}{}
}

{{.InType| godef}}

func (m *{{ .InType | goid }}) MessagePayload() {{.PayloadType| gousage}} {
    return m.Payload
}

func (m *{{ .InType | goid }}) MessageHeaders() {{$headersType| gousage}} {
    return m.Headers
}

{{- if .CorrelationIDPromise}}
func (m {{ .InType | goid }}) CorrelationID() (value {{.CorrelationIDPromise.T.TargetVarType .InType | gousage}}}, err error) {
    {{ .CorrelationIDPromise.T.RenderGetterBody "value" .InType | gousage}}
    return
}
{{- end}}
