{{/* dot == render.Channel */}}
{{define "client/channel"}}
type {{$ | goID}}Cmd struct {
    // Parameters
    {{- range $k := .Parameters.Entries}}
	    {{$k | goID}} string `arg:"--{{$k | toQuotable | toKebabCase}},required" help:"Channel parameter: {{$k | toQuotable}}"`
    {{- end}}

	// Servers
    {{- range .BoundServers}}
        {{- if not (impl .Protocol)}}{{continue}}{{end}}
	    {{. | goID}}Cmd *{{. | goID}}CliCmd `arg:"subcommand:{{.Name | toQuotable | toKebabCase}}" help:"Server: {{.Name | toQuotable}}"`
    {{- end}}
}

func channel{{$ | goID}}(ctx {{goPkgExt "context"}}Context, args *{{$ | goID}}Cmd, opts channelOptions) error {
    {{- if .Parameters.Len}}
        channelParams := {{goPkg .}}{{goID .}}Parameters{
            {{- range $k, $v := .Parameters.Entries}}
                {{$k | goID}}: {{goPkg $v}}{{goID $v}}(args.{{$k | goID}}),
            {{- end}}
        }
	    {{goPkgExt "log/slog"}}Debug("Channel parameters", "value", channelParams)
    {{- end}}

	switch {
    {{- range .BoundServers}}
        {{- if not (impl .Protocol)}}{{continue}}{{end}}
        {{$implTemplateCtx := dict "Object" $ "Server" . "Kind" "channel"}}
        case args.{{. | goID}}Cmd != nil:
            {{template "client/pubsub/proto/serverPubSub" $implTemplateCtx}}
    {{- end}}
	default:
		showCliError("No server selected. Append --help for more information", opts.cliParser)
	}

	return nil
}
{{- end}}
