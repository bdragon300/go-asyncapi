{{/* dot == render.SecurityScheme */}}

{{define "code/security/userPassword"}}
func New{{goID .}}Security(credentials func() (username, password string)) {{goID .}}Security {
    res := {{goID .}}Security{}
    res.credentials = credentials
    return res
}

type {{goID .}}Security struct {
    credentials func() (string, string)
}

func (s {{goID .}}Security) AuthType() string {
    return "userPassword"
}

func (s {{goID .}}Security) UserPassword() (string, string) {
    return s.credentials()
}

{{- range .BoundServers}}
    func (s {{goID $}}Security) {{. | goID}}Security() {}
{{- end}}
{{- range .BoundOperations}}
    func (s {{goID $}}Security) {{. | goID}}Security() {}
{{- end}}

{{- end}}

{{define "code/security/apiKey"}}
{{/* Different services may accept the API key as a standalone value or as a username/password value.
     So, we generate here two variants for both cases, since the AsyncAPI doesn't allow to distinguish this for 'apiKey' type.
  */}}
func New{{goID .}}Security(credentials func() string) {{goID .}}Security {
    res := {{goID .}}Security{credentials: credentials}
    return res
}

type {{goID .}}Security struct {
    credentials func() string
}

func (s {{goID .}}Security) AuthType() string {
    return "apiKey"
}

func (s {{goID .}}Security) APIKey() string {
    return s.credentials()
}

func (s {{goID .}}Security) In() string {
    return {{goLit .Params.In}}
}

{{- range .BoundServers}}
    func (s {{goID $}}Security) {{. | goID}}Security() {}
{{- end}}
{{- range .BoundOperations}}
    func (s {{goID $}}Security) {{. | goID}}Security() {}
{{- end}}
    
func New{{goID .}}SecurityUserPassword(credentials func() (username, password string)) {{goID .}}SecurityUserPassword {
    res := {{goID .}}SecurityUserPassword{credentials: credentials}
    return res
}
    
func New{{goID .}}SecurityUserOrPassword(credentials func() string) {{goID .}}SecurityUserPassword {
    res := {{goID .}}SecurityUserPassword{}
    res.credentials = func() (string, string) {
        {{- if eq .Params.In "user"}}
            return credentials(), ""
        {{- else if eq .Params.In "password"}}
            return "", credentials()
        {{- else}}
            return "", ""  // WARNING: 'in' param must be either 'user' or 'password', got {{goLit .Params.In}}
        {{- end}}
    }
    return res
}

type {{goID .}}SecurityUserPassword struct {
    credentials func() (string, string)
}

func (s {{goID .}}SecurityUserPassword) AuthType() string {
    return "apiKey"
}

func (s {{goID .}}SecurityUserPassword) UserPassword() (string, string) {
    return s.credentials()
}

func (s {{goID .}}SecurityUserPassword) In() string {
    return {{goLit .Params.In}}
}

{{- range .BoundServers}}
    func (s {{goID $}}SecurityUserPassword) {{. | goID}}Security() {}
{{- end}}
{{- range .BoundOperations}}
    func (s {{goID $}}SecurityUserPassword) {{. | goID}}Security() {}
{{- end}}

{{- end}}

{{/* dot == render.SecurityScheme */}}
{{with tryTmpl (print "code/security/" .SchemeType) .}}
    {{- pin $}}
    {{.}}
{{end}}