{{- /* dot == render.Server */}}

{{define "code/proto/mqtt/server/impl/github.com/eclipse/paho.mqtt.golang/connectFunction"}}
func Connect{{ . | goID }}Bidi(
    ctx {{goPkgExt "context"}}Context,
    url *{{goPkgExt "net/url"}}URL,
    {{with $.SecuritySchemes}}security {{$ | goID}}Security,{{end}}
    opts *{{goPkgExt "github.com/eclipse/paho.mqtt.golang"}}ClientOptions,
) (*{{ . | goID }}Closable, error) {
    var bindings *{{goPkgUtil .Protocol}}ServerBindings
    {{- if .BindingsProtocols | has .Protocol}}
        bindings = {{goPkgRun}}ToPtr({{goPkg .}}{{goID .}}Bindings.{{.Protocol | goID}}())
    {{- end}}
    client, err := {{goPkgImpl .Protocol}}NewClient(ctx, url.String(), bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts)
    if err != nil {
        return nil, err
    }
    producer, consumer := client, client
    return &{{ . | goID }}Closable{
        {{. | goID}}{producer: producer, consumer: consumer},
    }, nil
}
{{- end}}

{{define "code/proto/mqtt/server/impl/github.com/eclipse/paho.mqtt.golang/connectProducerFunction"}}
func Connect{{ . | goID }}Producer(
    ctx {{goPkgExt "context"}}Context,
    url *{{goPkgExt "net/url"}}URL,
    {{with $.SecuritySchemes}}security {{$ | goID}}Security,{{end}}
    opts *{{goPkgExt "github.com/eclipse/paho.mqtt.golang"}}ClientOptions,
) (*{{ . | goID }}Closable, error) {
    var bindings *{{goPkgUtil .Protocol}}ServerBindings
    {{- if .BindingsProtocols | has .Protocol}}
        bindings = {{goPkgRun}}ToPtr({{goPkg .}}{{goID .}}Bindings{}.{{.Protocol | goID}}())
    {{- end}}
    producer, err := {{goPkgImpl .Protocol}}NewClient(ctx, url.String(), bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts)
    if err != nil {
        return nil, err
    }
    return &{{ . | goID }}Closable{
        {{. | goID}}{producer: producer},
    }, nil
}
{{- end}}

{{define "code/proto/mqtt/server/impl/github.com/eclipse/paho.mqtt.golang/connectConsumerFunction"}}
func Connect{{ . | goID }}Consumer(
    ctx {{goPkgExt "context"}}Context,
    url *{{goPkgExt "net/url"}}URL,
    {{with $.SecuritySchemes}}security {{$ | goID}}Security,{{end}}
    opts *{{goPkgExt "github.com/eclipse/paho.mqtt.golang"}}ClientOptions,
) (*{{ . | goID }}Closable, error) {
    var bindings *{{goPkgUtil .Protocol}}ServerBindings
    {{- if .BindingsProtocols | has .Protocol}}
        bindings = {{goPkgRun}}ToPtr({{goPkg .}}{{goID .}}Bindings{}.{{.Protocol | goID}}())
    {{- end}}
    consumer, err := {{goPkgImpl .Protocol}}NewClient(ctx, url.String(), bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts)
    if err != nil {
        return nil, err
    }
    return &{{ . | goID }}Closable{
        {{. | goID}}{consumer: consumer},
    }, nil
}
{{- end}}