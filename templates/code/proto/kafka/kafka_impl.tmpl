{{- /* dot == render.Server */}}

{{define "code/proto/kafka/server/impl/github.com/twmb/franz-go/connectFunction"}}
func Connect{{ . | goIDUpper }}Bidi(
    ctx {{goPkgExt "context"}}Context,
    url *{{goPkgExt "net/url"}}URL,
    {{with $.SecuritySchemes}}security {{$ | goIDUpper}}Security,{{end}}
    opts ...{{goPkgExt "github.com/twmb/franz-go/pkg/kgo"}}Opt,
) (*{{ . | goIDUpper }}Closable, error) {
    var bindings *{{goPkgUtil .Protocol}}ServerBindings
    {{- if .BindingsProtocols | has .Protocol}}
        bindings = {{goPkgRun}}ToPtr({{goPkg .}}{{goIDUpper .}}Bindings{}.{{.Protocol | goIDUpper}}())
    {{- end}}
    producer := {{goPkgImpl .Protocol}}NewProducer([]string{url.Host}, bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts...)
    consumer := {{goPkgImpl .Protocol}}NewConsumer([]string{url.Host}, bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts...)
    return &{{ . | goIDUpper }}Closable{
        {{. | goIDUpper}}{producer: producer, consumer: consumer},
    }, nil
}
{{- end}}

{{define "code/proto/kafka/server/impl/github.com/twmb/franz-go/connectProducerFunction"}}
func Connect{{ . | goIDUpper }}Producer(
    ctx {{goPkgExt "context"}}Context,
    url *{{goPkgExt "net/url"}}URL,
    {{with $.SecuritySchemes}}security {{$ | goIDUpper}}Security,{{end}}
    opts ...{{goPkgExt "github.com/twmb/franz-go/pkg/kgo"}}Opt,
) (*{{ . | goIDUpper }}Closable, error) {
    var bindings *{{goPkgUtil .Protocol}}ServerBindings
    {{- if .BindingsProtocols | has .Protocol}}
        bindings = {{goPkgRun}}ToPtr({{goPkg .}}{{goIDUpper .}}Bindings{}.{{.Protocol | goIDUpper}}())
    {{- end}}
    producer := {{goPkgImpl .Protocol}}NewProducer([]string{url.Host}, bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts...)
    return &{{ . | goIDUpper }}Closable{
        {{. | goIDUpper}}{producer: producer},
    }, nil
}
{{- end}}

{{define "code/proto/kafka/server/impl/github.com/twmb/franz-go/connectConsumerFunction"}}
func Connect{{ . | goIDUpper }}Consumer(
    ctx {{goPkgExt "context"}}Context,
    url *{{goPkgExt "net/url"}}URL,
    {{with $.SecuritySchemes}}security {{$ | goIDUpper}}Security,{{end}}
    opts ...{{goPkgExt "github.com/twmb/franz-go/pkg/kgo"}}Opt,
) (*{{ . | goIDUpper }}Closable, error) {
    var bindings *{{goPkgUtil .Protocol}}ServerBindings
    {{- if .BindingsProtocols | has .Protocol}}
        bindings = {{goPkgRun}}ToPtr({{goPkg .}}{{goIDUpper .}}Bindings{}.{{.Protocol | goIDUpper}}())
    {{- end}}
    consumer := {{goPkgImpl .Protocol}}NewConsumer([]string{url.Host}, bindings, {{if $.SecuritySchemes}}security{{else}}nil{{end}}, opts...)
    return &{{ . | goIDUpper }}Closable{
        {{. | goIDUpper}}{consumer: consumer},
    }, nil
}
{{- end}}