{{- /* dot == render.ProtoChannel */}}
{{define "code/proto/kafka/channel/newFunction/block1"}}
    res.topic = res.address.String()
    {{- if .BindingsProtocols | has .Protocol}}
        bindings := {{goPkg .Channel}}{{goIDUpper .Channel}}Bindings{}.{{.Protocol | goIDUpper}}()
        if bindings.Topic != "" {
            res.topic = bindings.Topic
        }
    {{- end}}
{{- end}}

{{define "code/proto/kafka/channel/publishMethods/block1"}}
    envelope.SetTopic(c.Topic())
{{- end}}

{{define "code/proto/kafka/channel/bindings/values"}}
{{- goPkgUtil "kafka"}}ChannelBindings{
    {{- with .Bindings.Values.Map.kafka}}
        {{with .topic }}Topic: {{goLit .}},{{end}}
        {{with .partitions }}Partitions: {{goLit .}},{{end}}
        {{with .replicas }}Replicas: {{goLit .}},{{end}}
        {{with .topicConfiguration }}TopicConfiguration: {{goPkgUtil "kafka"}}TopicConfiguration{
            {{with .cleanupPolicy }}CleanupPolicy: {{goPkgUtil "kafka"}}TopicCleanupPolicy{
                {{with .delete }}Delete: {{goLit .}},{{end}}
                {{with .compact }}Compact: {{goLit .}},{{end}}
            },{{end}}
            {{with .retentionTime }}RetentionTime: {{goPkgExt "time"}}Duration({{goLit .}}*{{goPkgExt "time"}}Milliseconds),{{end}}
            {{with .retentionBytes }}RetentionBytes: {{goLit .}},{{end}}
            {{with .deleteRetentionTime }}DeleteRetentionTime: {{goPkgExt "time"}}Duration({{goLit .}}*{{goPkgExt "time"}}Milliseconds),{{end}}
            {{with .maxMessageBytes }}MaxMessageBytes: {{goLit .}},{{end}}
        },{{end}}
    {{- end}}
}
{{- end}}

{{template "code/proto/channel/newFunction" .}}
{{template "code/proto/channel/serverInterface" .}}
{{template "code/proto/channel/openFunction" .}}

type {{. | goIDUpper}}{{.Protocol | goIDUpper}} struct {
    address    {{goPkgRun}}ParamString
    {{if .IsPublisher}}publisher  {{goPkgUtil .Protocol}}Publisher{{end}}
    {{if .IsSubscriber}}subscriber {{goPkgUtil .Protocol}}Subscriber{{end}}
    topic string
}

func (c {{. | goIDUpper}}{{.Protocol | goIDUpper}}) Topic() string {
    return c.topic
}

{{template "code/proto/channel/commonMethods" .}}
{{if .IsPublisher}}{{template "code/proto/channel/publishMethods" .}}{{end}}
{{if .IsSubscriber}}{{template "code/proto/channel/subscribeMethods" .}}{{end}}
