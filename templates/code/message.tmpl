{{- /* dot == render.Message */}}
{{- pin .}}

{{- if $bt := .BindingsType }}
    {{- $bt | goDef }}
    {{- range $proto := $.BindingsProtocols}}
        {{- $bindingsValue := $.ProtoBindingsValue $proto}}
        func (c {{ $bt | goUsage }}) {{ $proto | goIDUpper }}() {{$bindingsValue.Type | goUsage}} {
            b := {{$bindingsValue | goUsage}}
            {{- $jvals := $.Bindings.JSONValues.GetOrEmpty $proto}}
            {{- range $jval := $jvals.Entries}}
                {{ $jval.Key | toCamelCase }} := {{$jval.Value | goLit}}
                _ = {{goQual "encoding/json.Unmarshal"}}([]byte({{$jval.Key | toCamelCase }}), &b.{{$jval.Key}})
            {{- end}}
            return b
        }
    {{- end}}
{{- end }}

{{- if .IsPublisher}}
    type {{ . | goIDUpper }}Sender interface {
        SetPayload(payload {{.PayloadType | goUsage}}) *{{ .OutType | goIDUpper }}
        SetHeaders(headers {{.HeadersType | goUsage}}) *{{ .OutType | goIDUpper }}
        {{- if isVisible .CorrelationID}}
            {{- $ctx := dict "SourceVarName" "m" "RuntimeExpression" .CorrelationID.BaseRuntimeExpression "TargetType" .OutType}}
            SetCorrelationID(value {{template "code/runtimeExpression/varType" $ctx}}) *{{ .OutType | goIDUpper }}
        {{- end}}
    }

    {{.OutType | goDef}}

    func (m *{{ .OutType | goIDUpper }}) SetPayload(payload {{.PayloadType | goUsage}}) *{{ .OutType | goIDUpper }} {
        m.Payload = payload
        return m
    }

    func (m *{{ .OutType | goIDUpper }}) SetHeaders(headers {{.HeadersType | goUsage}}) *{{ .OutType | goIDUpper }} {
        m.Headers = headers
        return m
    }

    {{- if isVisible .CorrelationID}}
        {{- $ctx := dict "SourceVarName" "m" "RuntimeExpression" .CorrelationID.BaseRuntimeExpression "TargetType" .OutType}}
        func (m *{{ .OutType | goIDUpper }}) SetCorrelationID(value {{template "code/runtimeExpression/varType" $ctx}}) *{{ .OutType | goIDUpper }} {
            {{template "code/runtimeExpression/setterBody" $ctx}}
            return m
        }
    {{- end}}
{{- end}}

{{- if .IsSubscriber }}
    type {{ $ | goIDUpper }}Receiver interface {
        Payload() {{.PayloadType | goUsage}}
        Headers() {{.HeadersType | goUsage}}
        {{- if isVisible .CorrelationID}}
            {{- $ctx := dict "SourceVarName" "m" "RuntimeExpression" .CorrelationID.BaseRuntimeExpression "TargetType" .InType}}
            CorrelationID() (value {{template "code/runtimeExpression/varType" $ctx}}, err error)
        {{- end}}
    }

    {{.InType | goDef}}

    func (m *{{ .InType | goIDUpper }}) Payload() {{.PayloadType | goUsage}} {
        return m.payload
    }

    func (m *{{ .InType | goIDUpper }}) Headers() {{.HeadersType | goUsage}} {
        return m.headers
    }

    {{- if isVisible .CorrelationID}}
        {{- $ctx := dict "SourceVarName" "m" "RuntimeExpression" .CorrelationID.BaseRuntimeExpression "TargetType" .InType}}
        func (m {{ .InType | goIDUpper }}) CorrelationID() (value {{template "code/runtimeExpression/varType" $ctx}}, err error) {
            {{template "code/runtimeExpression/getterBody" $ctx}}
            return
        }
    {{- end}}
{{- end}}
