{{- /* dot == common.Artifact: Ref -> render.Channel or render.Channel */}}
{{- with $channel := deref .}}

{{- with once .ParametersType }}
    {{ . | goDef }}
{{- end }}

func {{$ | goIDUpper}}Address({{with .ParametersType}}params {{. | goUsage}}{{end}}) {{goQualR "ParamString"}} {
{{- if .ParametersType}}
    paramMap := map[string]string{
    {{- range .Parameters}}
        {{.Name | goLit}}: string(params.{{. | goIDUpper }}),
    {{- end}}
    }
    return {{goQualR "ParamString"}}{
        Expr: {{ .Address | goLit}},
        Parameters: paramMap,
    }
{{- else}}
    return {{goQualR "ParamString"}}{
        Expr: {{ .Address | goLit}},
    }
{{- end}}
}

{{- with $bindingsType := once .BindingsType }}
    {{ $bindingsType | goDef }}
    {{- range $proto := $channel.BindingsProtocols }}
        {{- $bindingsValue := $channel.ProtoBindingsValue $proto }}
        func (c {{ $bindingsType | goUsage }}) {{ $proto | goIDUpper }}() {{$bindingsValue.Type | goUsage}} {
            b := {{$bindingsValue | goUsage}}
            {{- $jvals := $channel.Bindings.JSONValues.GetOrEmpty $proto }}
            {{- range $jvals.Entries}}
                {{.Key | toCamelCase }} := {{.Value | goLit}}
                _ = {{goQual "encoding/json.Unmarshal"}}([]byte({{.Key | toCamelCase }}), &b.{{.Key}})
            {{- end}}
            return b
        }
    {{- end}}
{{- end}}

{{- end}}