version: '3'

method: checksum

env:
  TOOLS_DIR: "{{.ROOT_DIR}}/.tools"
  GOBIN: "{{.TOOLS_DIR}}"
  PATH: "{{.TOOLS_DIR}}:{{.PATH}}"

tasks:
  tools:
    desc: "Installing development tools"
    cmds:
      - go install -v github.com/gohugoio/hugo@latest
      - go install github.com/golangci/golangci-lint/v2/cmd/golangci-lint@latest

  docs-server:
    desc: "Runs docs server"
    dir: "docs/go-asyncapi"
    deps:
      - tools
    cmds:
      - "{{.TOOLS_DIR}}/hugo server"

  inflate-codeextra:
    desc: "Inflate codeextra templates into the Go code"
    cmds:
      - go run tools/inflate_codeextra.go -auto-remove {{.CLI_ARGS}}

  lint:
    desc: "Run linters"
    deps:
      - tools
    cmds:
      - golangci-lint run --fix
